from typing import Any
from services.tests.general import get_return_data, request_base

url = "planner-info/planners"

input: dict[str, Any] = {"text_info": ""}


def test_correct_results_influenza():
    input["text_info"] = (
        "Informações do paciente\nJoana Ribeiro, 42 anos, comparece ao pronto-atendimento com queixa de febre alta e dores no corpo há dois dias.\n\nHistórico da moléstia atual\nPaciente relata início súbito de febre alta, calafrios, cefaleia intensa, dores musculares generalizadas, coriza e tosse seca há cerca de dois dias. Refere também prostração importante e dor de garganta, sem presença de vômitos ou diarreia. Informa que o quadro começou após contato próximo com o neto, que apresentou sintomas semelhantes na semana anterior. Nega dispneia, dor torácica ou outros sintomas respiratórios mais graves até o momento.\n\nHistória patológica pregressa\nA paciente é portadora de hipertensão arterial sistêmica, em uso regular de losartana, com controle adequado. Nega outras doenças crônicas, internações prévias ou cirurgias. Refere não possuir alergias conhecidas a medicamentos ou alimentos e nunca fez uso de imunossupressores.\n\nHistórico familiar\nRelata que a mãe é hipertensa e diabética, ambas condições controladas com medicação. O pai faleceu aos 70 anos devido a um acidente vascular cerebral isquêmico. Nega histórico familiar de doenças genéticas, autoimunes ou respiratórias crônicas. Não há casos conhecidos de neoplasias de aparecimento precoce na família.\n\nHistórico social\nTrabalha como professora da educação infantil em escola pública, tendo contato frequente com crianças. Nega tabagismo e faz uso ocasional de bebidas alcoólicas em eventos sociais. Refere sono regular de aproximadamente sete horas por noite, mas não pratica atividade física com regularidade. Alimenta-se de forma variada, embora reconheça consumo esporádico de alimentos ultraprocessados durante a semana.\n\nExame físico\nApresenta-se em bom estado geral, embora com fácies febril e discreta prostração. Está febril (38,7 °C), com frequência cardíaca de 104 bpm, pressão arterial de 130/80 mmHg e saturação periférica de oxigênio de 97% em ar ambiente. Mucosas orais e nasais estão hiperemiadas, com orofaringe levemente avermelhada, sem exsudato. Ausculta pulmonar revela murmúrio vesicular presente e simétrico, sem ruídos adventícios. Abdome flácido, indolor à palpação, sem visceromegalias. Demais sistemas sem alterações significativas.\n\nExames complementares\nHemograma: leucocitose leve com predomínio de neutrófilos\nPCR: 12 mg/L\nTeste rápido para Influenza A: positivo\nRaio-X de tórax: campos pulmonares limpos, sem infiltrado evidente\n\n## Código CID\n### Sumário de códigos encontrados\n1. **J10.1 – Influenza [gripe] devida a vírus influenza identificado, com outras manifestações respiratórias**\n2. **I10 – Hipertensão essencial (primária)**\n3. **R50.9 – Febre, não especificada**\n4. **R51 – Cefaleia**\n5. **M79.1 – Mialgia**\n6. **R05 – Tosse**\n7. **R07.0 – Dor de garganta**\n8. **R53 – Mal-estar e fadiga**\n9. **D72.8 – Outros transtornos especificados dos leucócitos (leucocitose)**\n10. **R79.8 – Outros achados anormais especificados de exames químicos do sangue (PCR elevada)**\n> Observação: em prática de codificação, geralmente o diagnóstico principal (influenza) e comorbidades relevantes (hipertensão) são prioritários; os sintomas costumam ser codificados apenas se houver necessidade específica. Aqui, todos os códigos possíveis a partir dos dados fornecidos estão listados.\n---\n### Detalhes por código\n#### 1. Código CID\n**J10.1**\n- **Descrição:** Influenza [gripe] devida a vírus influenza identificado, com outras manifestações respiratórias\n- **Categoria Principal:** Capítulo X – Doenças do aparelho respiratório (J00–J99)\n- **Nome:** Influenza por vírus identificado, com outras manifestações respiratórias\n- **Definição:** Influenza aguda causada por vírus influenza comprovado por exame laboratorial ou outro método de identificação, caracterizada por início súbito de febre, sintomas respiratórios altos (coriza, tosse, dor de garganta) e sintomas sistêmicos (mialgia, cefaleia, mal-estar), **sem pneumonia**.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Usar J10.* quando há identificação do vírus influenza (por exemplo, teste rápido positivo, PCR, cultura).\n- Subcategoria **J10.1** específica para casos em que:\n    - há manifestações respiratórias (tosse, coriza, dor de garganta, irritação de vias aéreas superiores);\n    - não há evidência de pneumonia clínica ou radiológica.\n- Excluir J10.0 (com pneumonia) quando o RX de tórax é normal e não há sinais clínicos de pneumonia.\n- Pode coexistir com sintomas sistêmicos intensos (mialgia, cefaleia, prostração), sem necessidade de subcategoria adicional, pois estes estão incluídos na síndrome gripal.\n- **Justificativa de associação:**\n- Teste rápido para **Influenza A: positivo** → vírus influenza identificado.\n- Quadro agudo de 2 dias com:\n    - febre alta, calafrios;\n    - tosse seca, coriza, dor de garganta;\n    - cefaleia intensa, dores musculares generalizadas, prostração;\n- Ausência de infiltrado pulmonar em RX de tórax e ausculta pulmonar sem ruídos adventícios → **sem pneumonia**, logo J10.0 é excluído.\n→ Portanto, o código mais adequado é **J10.1** (influenza por vírus identificado com outras manifestações respiratórias).\n---\n#### 2. Código CID\n**I10**\n- **Descrição:** Hipertensão essencial (primária)\n- **Categoria Principal:** Capítulo IX – Doenças do aparelho circulatório (I00–I99)\n- **Nome:** Hipertensão arterial essencial (primária)\n- **Definição:** Elevação crônica da pressão arterial sem causa secundária identificável (não atribuída a doença renal, endócrina, etc.), frequentemente tratada de forma contínua com anti-hipertensivos.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Utilizado para pacientes com diagnóstico estabelecido de hipertensão arterial sistêmica, controlada ou não, sem etiologia secundária descrita no prontuário.\n- Abrange a hipertensão tratada com monoterapia ou combinação de fármacos.\n- Importante como comorbidade em qualquer atendimento agudo, pois pode influenciar conduta e risco cardiovascular.\n- **Justificativa de associação:**\n- História patológica pregressa: “**portadora de hipertensão arterial sistêmica, em uso regular de losartana, com controle adequado**.”\n- Não há menção de causa secundária (doença renal, endócrina etc.).\n→ Configura **hipertensão essencial**, código **I10**.\n---\n#### 3. Código CID\n**R50.9**\n- **Descrição:** Febre, não especificada\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório, não classificados em outra parte (R00–R99)\n- **Nome:** Febre, não especificada\n- **Definição:** Elevação da temperatura corporal acima dos valores considerados normais, sem especificação da causa no próprio código.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Usado quando se deseja registrar o sintoma febre como dado clínico relevante.\n- Em presença de diagnóstico etiológico (influenza), muitas vezes o sintoma não é codificado separadamente, mas é perfeitamente aceitável listá-lo se o foco for documentar o quadro clínico completo.\n- **Justificativa de associação:**\n- Queixa principal de “**febre alta**” há dois dias.\n- Exame físico: temperatura de **38,7 °C**.\n→ Sintoma febre presente e documentado, compatível com **R50.9**.\n---\n#### 4. Código CID\n**R51**\n- **Descrição:** Cefaleia\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório (R00–R99)\n- **Nome:** Cefaleia\n- **Definição:** Dor localizada na região da cabeça, sem especificação de tipo (tensional, enxaqueca, etc.) quando codificada em R51.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Utilizado para dor de cabeça como sintoma em diversos contextos.\n- Em quadros infecciosos agudos, a cefaleia é frequentemente secundária à doença de base (aqui, influenza), mas pode ser registrada.\n- **Justificativa de associação:**\n- HMA: “**cefaleia intensa**” associada ao quadro febril.\n- Não há descrição de enxaqueca ou outro tipo específico → cefaleia inespecífica.\n→ Código sintomático adequado: **R51**.\n---\n#### 5. Código CID\n**M79.1**\n- **Descrição:** Mialgia\n- **Categoria Principal:** Capítulo XIII – Doenças do sistema osteomuscular e do tecido conjuntivo (M00–M99)\n- **Nome:** Mialgia\n- **Definição:** Dor muscular localizada ou generalizada, de origem não especificada, podendo estar associada a infecções virais, esforço físico, doenças reumáticas etc.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Usado para dor muscular sem diagnóstico etiológico distinto no próprio código.\n- Em síndromes gripais, mialgia difusa é um achado típico e pode ser registrada como tal.\n- **Justificativa de associação:**\n- HMA: “**dores musculares generalizadas**”.\n- Não há descrição de trauma, doenças musculares específicas ou outra etiologia.\n→ Sintoma de mialgia codificável como **M79.1**.\n---\n#### 6. Código CID\n**R05**\n- **Descrição:** Tosse\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório (R00–R99)\n- **Nome:** Tosse\n- **Definição:** Expulsão súbita e ruidosa de ar dos pulmões, voluntária ou reflexa, acompanhando diversas doenças respiratórias.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Sintoma respiratório muito comum, usado quando se quer explicitar a presença de tosse.\n- Em casos de influenza, a tosse faz parte do quadro síndrome gripal, mas ainda assim pode ser codificada como sintoma.\n- **Justificativa de associação:**\n- HMA: “**tosse seca**” há cerca de dois dias.\n- Não há especificação adicional (expectorante, hemoptise etc.), logo código genérico de tosse é adequado.\n→ **R05** devidamente aplicável.\n---\n#### 7. Código CID\n**R07.0**\n- **Descrição:** Dor de garganta\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório (R00–R99)\n- **Nome:** Dor de garganta\n- **Definição:** Dor localizada na região da orofaringe/hipofaringe, seja por processo infeccioso, inflamatório, irritativo ou outro, sem especificação etiológica.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Usado quando a dor de garganta é descrita como sintoma, sem diagnóstico específico de faringite ou amigdalite (J02, J03 etc.).\n- Quando se opta por manter o diagnóstico global de influenza (sem faringite específica), a dor de garganta pode ser codificada como sintoma.\n- **Justificativa de associação:**\n- HMA: “**dor de garganta**”.\n- Exame físico: “**orofaringe levemente avermelhada, sem exsudato**”, mas o diagnóstico principal adotado foi influenza, não faringite isolada.\n→ Sintoma compatível com **R07.0**.\n---\n#### 8. Código CID\n**R53**\n- **Descrição:** Mal-estar e fadiga\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório (R00–R99)\n- **Nome:** Mal-estar e fadiga\n- **Definição:** Sensação de fraqueza, cansaço, prostração ou indisposição geral, não atribuída a uma condição específica no próprio código.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Comum em quadros infecciosos agudos como influenza.\n- Pode ser usado para documentar a intensidade do comprometimento geral do paciente.\n- **Justificativa de associação:**\n- HMA: “**prostração importante**”.\n- Exame físico: discreta prostração, apesar de bom estado geral.\n→ Sintoma de mal-estar/prostração enquadra-se em **R53**.\n---\n#### 9. Código CID\n**D72.8**\n- **Descrição:** Outros transtornos especificados dos leucócitos\n- **Categoria Principal:** Capítulo III – Doenças do sangue e dos órgãos hematopoéticos e alguns transtornos imunitários (D50–D89)\n- **Nome:** Outros transtornos especificados dos leucócitos\n- **Definição:** Alterações quantitativas ou qualitativas dos leucócitos não classificadas em categorias mais específicas, incluindo leucocitose.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Abrange **leucocitose** não atribuída a doenças hematológicas específicas.\n- Frequentemente secundária a processos infecciosos agudos, inflamações etc.\n- Em muitas situações, este código não é usado isoladamente quando a leucocitose é claramente reacional à infecção de base; contudo, é um código válido para registrar o achado laboratorial.\n- **Justificativa de associação:**\n- Hemograma: “**leucocitose leve com predomínio de neutrófilos**.”\n- Não há evidência de doença hematológica primária, sendo compatível com leucocitose reacional ao quadro infeccioso.\n→ Achado laboratorial compatível com **D72.8**.\n---\n#### 10. Código CID\n**R79.8**\n- **Descrição:** Outros achados anormais especificados de exames químicos do sangue\n- **Categoria Principal:** Capítulo XVIII – Sintomas, sinais e achados anormais de exames clínicos e de laboratório (R00–R99)\n- **Nome:** Outros achados anormais especificados de exames químicos do sangue\n- **Definição:** Alterações em parâmetros de exames bioquímicos sanguíneos que não possuem código específico em outras categorias.\n- **Descrição Detalhada (critérios, cenários de uso, observações):**\n- Inclui resultados alterados de marcadores inflamatórios (como proteína C reativa) quando não codificados de outra forma.\n- Em geral é código secundário, usado quando se deseja registrar explicitamente o achado laboratorial.\n- **Justificativa de associação:**\n- Exames complementares: **PCR: 12 mg/L**, valor descrito como elevado para o contexto.\n- Não há outro código mais específico para PCR elevada.\n→ Achado enquadrável em **R79.8**.\n---\nMinistério da Saúde - CID-10 Brasil, 10ª Revisão, 2020.\n\n### Dados coletados\n\n- **Identificação e medidas**:\n- Idade: 42 anos\n- Sexo: Feminino\n- Peso: não informado\n- Altura: não informado\n- IMC: não informado\n\n- **Sintomas principais**:\n- Febre alta (38,7 °C)\n- Calafrios\n- Cefaleia intensa\n- Dores musculares generalizadas\n- Coriza\n- Tosse seca\n- Prostração importante\n- Dor de garganta\n\n- **Histórico relevante**:\n- **História patológica pregressa**: Hipertensão arterial sistêmica controlada com losartana. Nega outras doenças crônicas, internações ou cirurgias. Sem alergias conhecidas.\n- **Histórico familiar**: Mãe hipertensa e diabética, pai falecido por acidente vascular cerebral. Sem histórico de doenças genéticas ou neoplasias precoces.\n- **Histórico social**: Professora da educação infantil, sem tabagismo, uso ocasional de álcool. Sono regular, sem atividade física regular.\n\n- **Exames disponíveis**:\n- Hemograma: leucocitose leve com predomínio de neutrófilos\n- PCR: 12 mg/L\n- Teste rápido para Influenza A: positivo\n- Raio-X de tórax: campos pulmonares limpos, sem infiltrado evidente\n\n### Avaliação diagnóstica (sumária)\n\n- **Condição(ões) mais prováveis**: Influenza (J10.1) confirmada pelo teste rápido positivo, com sintomas compatíveis.\n- **Principais diferenciais**: Outras infecções virais (como COVID-19), infecções bacterianas respiratórias, e outras síndromes gripais.\n- **Critérios oficiais atendidos**: Diagnóstico de influenza confirmado por teste laboratorial, com quadro clínico compatível.\n- **Achados críticos/inesperados**: Nenhum achado crítico além da confirmação da influenza.\n- **Justificativa sumária**: A paciente apresenta um quadro clínico clássico de influenza, com febre alta, sintomas respiratórios e mialgia, além de um teste rápido positivo. A ausência de sinais de pneumonia e a leucocitose leve são consistentes com uma infecção viral.\n\n### Plano de investigação adicional\n\n- **Exames sugeridos**:\n1. **Teste PCR para COVID-19**: Para descartar coinfecção, dada a similaridade dos sintomas.\n2. **Hemoculturas**: Para investigar possíveis infecções bacterianas, especialmente se a febre persistir.\n3. **Exames de função hepática e renal**: Para monitorar a saúde geral, especialmente em pacientes com doenças crônicas.\n\n### Referências (se disponíveis)\n\n- Diretrizes da ADA (American Diabetes Association)\n- Diretrizes do Ministério da Saúde sobre manejo de infecções respiratórias\n- Diretrizes da OMS sobre influenza\n\n### Resumo final\n- **Principais achados**: Febre alta, cefaleia, dores musculares, tosse seca, e teste rápido positivo para Influenza A.\n- **Diagnóstico provável**: Influenza (J10.1).\n- **Diferenciais**: Outras infecções virais e bacterianas.\n- **Critérios atendidos**: Diagnóstico confirmado por teste laboratorial.\n- **Próximos passos recomendados**: Realizar testes adicionais para COVID-19, hemoculturas e monitorar a função hepática e renal."
    )

    response = request_base(url, input)
    return_data: str = get_return_data(response)
    print(return_data)

    assert response.status_code == 200
    assert "coinfecção" in return_data
    assert "hemograma" in return_data
    assert "raio-x de tórax" in return_data
    assert "teste pcr para covid-19" in return_data


def test_correct_results_mieloma_multiplo():
    input["text_info"] = (
        "CASO CLÍNICO\n\nUm homem de 36 anos de idade, foi referenciado ao Departamento de Medicina\nInterna por anemia e insuficiência renal.\nO doente tinha recorrido a uma consulta de Medicina Geral e Familiar para avaliação de\nrotina. Nesta consulta foi identificada uma\nanemia macrocítica, elevação da velocidade\nde sedimentação (VS) e retenção azotada ligeira (Quadro I). Nesta consulta foi ainda\ndiagnosticado tumor de Whartin da parótida. Por complicação da citologia aspirativa\nda parótida, o doente foi medicado com\namoxicilina/ácido clavulânico e nimesulida.\nNa consulta de Anestesiologia pré-operatória do tumor de Whartin, o doente apresentava anemia com hemoglobina 7,6 g/dL\ne insuficiência renal com ureia 131 mg/dL e\ncreatinina 2,9 mg/dL (Quadro I), sendo referenciado à Medicina Interna.\n\nQuadro I – Evolução dos principais valores laboratoriais\n# Parâmetros Laboratoriais do Sangue - Dados Extraídos\n\n## Cronologia dos Exames\n- **60 dias antes**\n- **Dia 0** \n- **Dia 1**\n- **Dia 8**\n\n## Valores Laboratoriais\n\n### Hemograma\n- **Hemoglobina (g/dL)**: 11,4 → 7,8 → 6,7 → 10,0\n- **Hematócrito (%)**: 34,6 → 21,9 → 18,9 → 30,3\n- **Volume globular médio - VGM (fL)**: 107 → 104 → 103 → 98\n- **Hemoglobina globular média - HGM (pg)**: 35 → 37 → 37 → 32\n- **Leucócitos (x10³/L)**: 9,7 → 11,5 → 8,4 → 17,6\n- **Plaquetas (x10³/L)**: 331 → 465 → 396 → 354\n- **Reticulócitos (%)**: - → - → 1,2 → -\n\n### Marcadores Inflamatórios\n- **Velocidade de sedimentação (mm)**: 62 → - → 49 → -\n- **Proteína C reactiva (mg/dL)**: - → - → 1,56 → 2,92\n\n### Função Renal\n- **Ureia (mg/dL)**: 53 → 114 → 82 → 123\n- **Creatinina (mg/dL)**: 1,19 → 2,9 → 2,5 → 2,8\n\n### Proteínas\n- **Proteínas totais (g/dL)**: - → - → 5,2 → -\n- **Albumina (g/dL)**: - → - → 2,6 → -\n\n### Eletrólitos\n- **Sódio (mmol/L)**: 140 → 138 → 144 → 141\n- **Potássio (mmol/L)**: 4,35 → 5,8 → 4,7 → 4,8\n- **Cloro (mmol/L)**: 103 → 107 → 111 → 108\n\n### Metabolismo Mineral\n- **Cálcio (mg/dL)**: - → - → 8,4 → -\n- **Fósforo (mg/dL)**: - → - → 4,9 → -\n\n### Enzimas\n- **Desidrogenase láctica - LDH (UI/L)**: - → 130 → 125 → -\n\nExistia uma história com três meses de\nevolução de astenia, anorexia, emagrecimento de 8 kg (80 para 72 kg) e dejecções\nde fezes mais moles que o habitual. Não se\nconstataram perdas hemáticas aparentes,\nfebre ou queixas álgicas. Saliente-se que, no\ndia da consulta de Anestesiologia, o doente\ntinha tido jornada de trabalho nocturno\ncom duração superior a 8 horas, submetendo-se a esforço físico intenso. Nos antecedentes pessoais e hábitos, destacam-se\ncirurgia do testículo na infância e hábitos\ntabágicos quantificados em 20 unidades\nmaço-ano.\nNo exame físico, o doente encontrava-se\npálido, apirético, com pressão arterial 120-\n80 mmHg e pulso 95 batimentos por minuto. Verificava-se um aumento de volume da\nparótida direita. Não se palpavam linfadenopatias nas principais cadeias periféricas e\no exame de tórax e abdómen não apresentava alterações. Não existia edema periférico.\nNão apresentava alterações no exame neurológico.\nA anemia foi caracterizada como macrocítica arregenerativa, com factores hematínicos dentro da normalidade (Quadro I). Laboratorialmente, realçava-se ainda VS 49 mm,\nhipoalbuminemia (2,6 g/dL), hipo-gamaglobulinemia (Fig. 1) e proteinúria nefrótica (3,7 g/24h). A proteinúria caracterizava-se pela presença de marcadores de lesão\nglomerular (albumina, imunoglobulina G,\ntransferrina e haptoglobina), bem como\nde lesão tubular (beta2-microglobulina e\nalfa1-microglobulina). A ecografia renal\nmostrou rins de dimensões aumentadas e\na tomografia axial computorizada toraco-\n-abdomino-pélvica confirmou rins de tamanho aumentado, com densificação da gordura peri-renal e revelou lesões líticas do segundo arco costal direito, manúbrio esternal\ne ossos ilíacos. Procedeu-se então a mielograma e biópsia óssea que revelaram infiltração\nda medula óssea por plasmócitos, ocupando cerca de 75% dos espaços medulares da\namostra de biopsia óssea (Fig. 2). O doente\nfoi ainda submetido a biópsia renal cujo estudo histopatológico mostrou aspectos compatíveis com doença de depósito de cadeias\nleves K associada a nefropatia de cilindros\n(Fig. 3). A imunoelectroforese das proteínas\nséricas e urinárias veio a revelar uma proteína monoclonal IgA/K, com elevação das cadeias leves K livres. O valor de beta2-microglobulina era de 13,6 mg/L. A imunofenotipagem revelou plasmócitos com o fenótipo aberrante CD38++/CD138+/CD56+/CD45-/CD19-/CD117-. No estudo citogenético, identificou-se a translocação t(11;14)\n(q13;q32). A radiografia de esqueleto mostrou ainda lesões líticas da calote craniana. Estabeleceu-se o diagnóstico de mieloma\nmúltiplo IgA/K, com rim de mieloma e\ndoença de depósito de cadeias leves, estadio IIIB de Durie-Salmon e estadio III do\nInternational Staging System (ISS).\nDurante o internamento, o doente manteve-se praticamente assintomático, com\nflutuações discretas do valor de creatinina.\nPara permitir a realização de biópsia renal\ncom segurança, fez terapêutica transfusional com quatro unidades de concentrado\neritrocitário. Ao 7º dia de internamento iniciou terapêutica com dexametasona.\nO doente foi referenciado à consulta de Hematologia de hospital central oncológico,\nonde iniciou bortezomib, estando planeado\nauto-transplante de células estaminais com\ndose alta de melfalan.\n\n### Sumário\n1. **C90.00 - Mieloma múltiplo**\n\n### Detalhamento\n- **Código:** C90.00\n- **Categoria Principal:** Mieloma múltiplo\n- **Descrição Detalhada:** O mieloma múltiplo é uma neoplasia de células plasmáticas que se manifesta com infiltração da medula óssea e produção de proteínas monoclonais. Critérios diagnósticos incluem presença de plasmócitos clonais na medula óssea, lesões ósseas líticas, e disfunção renal associada à doença de cadeias leves.\n- **Justificativa:** O paciente apresenta infiltração da medula óssea por plasmócitos, lesões ósseas líticas, insuficiência renal associada a doença de depósito de cadeias leves, e presença de proteína monoclonal IgA/K, confirmando o diagnóstico de mieloma múltiplo.\n\n### Referências\n- Ministério da Saúde – CID-10 Brasil, 2020\n\n### Resumo Final\nO caso clínico apresentado refere-se a um homem de 36 anos diagnosticado com mieloma múltiplo (Código CID-10: C90.00). A associação foi baseada na presença de infiltração medular por plasmócitos, lesões ósseas líticas, insuficiência renal com características de nefropatia de cilindros, e presença de proteína monoclonal IgA/K. Estes achados são consistentes com os critérios diagnósticos para mieloma múltiplo, justificando a codificação e o tratamento subsequente. O paciente foi encaminhado para tratamento especializado, incluindo quimioterapia e planejamento de transplante de células estaminais.\n\n### Dados coletados\n- **Identificação e medidas**: \n  - Idade: 36 anos\n  - Sexo: Masculino\n  - Peso: 72 kg\n  - Altura: Não informado\n  - IMC: Não informado (peso e altura não disponíveis para cálculo)\n\n- **Sintomas principais**:\n  - Astenia\n  - Anorexia\n  - Emagrecimento de 8 kg\n  - Fezes mais moles que o habitual\n\n- **Histórico relevante**:\n  - Cirurgia do testículo na infância\n  - Hábitos tabágicos: 20 unidades maço-ano\n  - Tumor de Whartin da parótida\n\n- **Exames disponíveis**:\n  - Hemoglobina: 7,6 g/dL\n  - Ureia: 131 mg/dL\n  - Creatinina: 2,9 mg/dL\n  - Velocidade de sedimentação: 49 mm\n  - Proteína C reativa: 2,92 mg/dL\n  - Hipoalbuminemia: 2,6 g/dL\n  - Proteinúria nefrótica: 3,7 g/24h\n  - Beta2-microglobulina: 13,6 mg/L\n  - Translocação t(11;14) identificada\n\n### Avaliação diagnóstica (sumária)\n- **Condição(ões) mais prováveis**: Mieloma múltiplo (CID-10: C90.00)\n- **Principais diferenciais**: Doenças hematológicas como linfoma, outras neoplasias mieloides, e doenças autoimunes.\n- **Critérios oficiais atendidos**: Presença de plasmócitos clonais na medula óssea, lesões ósseas líticas, disfunção renal, e proteína monoclonal IgA/K.\n- **Achados críticos/inesperados**: Infiltração da medula óssea por plasmócitos ocupando 75% do espaço medular; lesões líticas em múltiplos locais ósseos.\n- **Justificativa sumária**: O paciente apresenta um quadro clínico compatível com mieloma múltiplo, incluindo anemia macrocítica arregenerativa, insuficiência renal, e características laboratoriais que confirmam a presença de doença de depósito de cadeias leves.\n\n### Plano de investigação adicional\n- **Biópsia renal**: Para avaliação histopatológica e confirmação da nefropatia de cilindros.\n- **Imunoeletroforese**: Para caracterização detalhada das proteínas monoclonais.\n- **Exames de imagem adicionais**: Para avaliação da extensão das lesões ósseas e monitoramento da resposta ao tratamento.\n\n### Referências (se disponíveis)\n- Ministério da Saúde – CID-10 Brasil, 2020\n\n### Resumo final\n- **Principais achados**:\n  - Anemia macrocítica e insuficiência renal\n  - Presença de proteína monoclonal IgA/K\n  - Lesões ósseas líticas e infiltração da medula óssea por plasmócitos\n\n- **Diagnóstico provável**: Mieloma múltiplo (CID-10: C90.00)\n\n- **Diferenciais**: Outras neoplasias hematológicas e doenças autoimunes\n\n- **Critérios atendidos**: Plasmócitos clonais, lesões ósseas, disfunção renal\n\n- **Próximos passos recomendados**: Início de tratamento com bortezomib e planejamento de auto-transplante de células estaminais.**Objetivo**\n\nO objetivo deste relatório é analisar o caso clínico de um homem de 36 anos diagnosticado com mieloma múltiplo, destacando os achados laboratoriais, a evolução clínica e as recomendações terapêuticas baseadas em evidências.\n\n**Metodologia**\n\nFoi realizada uma revisão detalhada dos dados clínicos e laboratoriais do paciente, incluindo hemograma, função renal, marcadores inflamatórios, e exames de imagem. O diagnóstico foi fundamentado na presença de plasmócitos clonais na medula óssea, lesões ósseas líticas, e a detecção de proteína monoclonal IgA/K.\n\n**Resultados e conclusões**\n\n- **Achados laboratoriais críticos**: Anemia macrocítica arregenerativa, insuficiência renal com creatinina elevada, hipoalbuminemia, e proteinúria nefrótica.\n- **Diagnóstico**: Mieloma múltiplo IgA/K, confirmado por infiltração medular por plasmócitos e presença de lesões ósseas líticas.\n- **Estadiamento**: Estadio IIIB de Durie-Salmon e estadio III do ISS.\n\n**Tratamento e recomendações**\n\n- **Terapia farmacológica**: Início de tratamento com bortezomib e dexametasona, planejando auto-transplante de células estaminais com dose alta de melfalan.\n- **Medidas não farmacológicas**: Monitoramento de função renal e suporte nutricional para gerenciar a hipoalbuminemia e perda de peso.\n- **Exames adicionais**: Continuação do acompanhamento com exames de imagem para monitorar a resposta ao tratamento e detecção precoce de novas lesões ósseas.\n\n**Referências**\n\n- Fontes não informadas.\n\n**Resumo final**\n\nO paciente de 36 anos apresenta um quadro clínico e laboratorial compatível com mieloma múltiplo, caracterizado por anemia macrocítica, insuficiência renal, e presença de proteína monoclonal IgA/K. O tratamento iniciado com bortezomib e dexametasona, juntamente com o planejamento de auto-transplante de células estaminais, está alinhado com as diretrizes para manejo do mieloma múltiplo, visando melhorar a qualidade de vida e o prognóstico do paciente."
    )

    response = request_base(url, input)
    return_data: str = get_return_data(response)
    print(return_data)

    assert response.status_code == 200
    assert "bortezomib" in return_data
    assert "dexametasona" in return_data
    assert "células estaminais" in return_data
    assert "função renal" in return_data
    assert "monitorar" in return_data


def test_correct_results_chagas():
    input["text_info"] = (
        "APRESENTAÇÃO DO CASO CLÍNICO\nPDS, 71 anos, sexo masculino, pardo, natural do norte de Minas, portador de Doença de\nChagas em acompanhamento médico irregular há 4 anos. Há aproximadamente 60 dias,\npaciente tem observado constipação, mal-estar ao se alimentar e distensão abdominal.\nA disfagia tem piorado e na última semana houve episódios persistentes de vômitos para\nalimentos sólidos, pastosos e líquidos, com restos alimentares. Foi internado há uma\nsemana com piora do quadro. Relata que seu peso habitual é de 68 kg e que teve perda\nde mais de 10 kg em seis meses, fraqueza em MMII, ausência de dejeções associados a\npouca ingesta de alimentos.\nNega febre, hematêmese, disúria, poliúria, oligúria e uso de medicações. Evacuação presente com fezes endurecidas, sem sangramentos.\nRefere passado de etilismo, durante aproximadamente 32 anos, com uso de bebidas destiladas, predominantemente. Abstêmio há 10 meses, nega tabagismo e outras drogas.\nAo exame físico: Paciente em REG, acianótico, anictérico, corado, afebril, caquético, 54 kg,\n152 cm de altura.\nAbdome escavado, flácido, ruídos hidroaéreos presentes, predominância de sons timpânicos, indolor à palpação superficial e profunda, ausência de massas ou visceromegalias.\nFC: 70 bpm, PA: 110x64 mmHg, FR: 16 IRPM\n\nEXAMES COMPLEMENTARES:\n\nLaboratório Valores obtidos Valores Referenciais\nHemograma\nHemoglobina 14g/dL 13,5g/dL – 17,5 g/dL\nLeucócitos 3.070/ ml 5.000/mm³ - 10.000 mm³\nPlaquetas 286.000 /mL 150.000 – 400.000/mL\nBioquímica\nGlicemia 92 mg/dL <100m mg/dL\nUreia 66 mg/dL 18 – 55 mg/dL\nCreatinina 0,9 mg/dL 0,8 – 1,3 mg/dL\nPotássio 3,9 mmol/L 3,5 – 4,5 mEq/L\nSódio 139 mEq/L 135 – 145 mEq/L\nFósforo 0,7 mmol/L 0,8-1,4 mmol/L\n\n**Sumário**\n\n1. K22.1 - Acalasia do esôfago\n\n**Detalhamento**\n\n- **Código**: K22.1\n- **Categoria Principal**: Acalasia do esôfago\n- **Descrição Detalhada**: A acalasia é um distúrbio da motilidade esofágica caracterizado pela incapacidade do esfíncter esofágico inferior de relaxar e pela ausência de peristaltismo no corpo do esôfago. Os sintomas incluem disfagia, regurgitação, perda de peso e dor torácica. É frequentemente associada à doença de Chagas.\n- **Justificativa**: O paciente apresenta disfagia progressiva, regurgitação e perda de peso significativa, sintomas clássicos de acalasia, especialmente em um contexto de doença de Chagas, que é uma causa conhecida dessa condição.\n\n**Referências**\n\n- Ministério da Saúde – CID-10 Brasil, 2020\n\n**Resumo Final**\n\nNeste caso, o paciente de 71 anos apresenta sintomas compatíveis com acalasia do esôfago (Código CID-10: K22.1), incluindo disfagia, regurgitação e perda de peso significativa, em um contexto de doença de Chagas. Esses achados justificam a associação com o código K22.1, sendo a acalasia uma complicação conhecida da doença de Chagas. Não foram identificados sinais de infecção ou outras complicações agudas associadas. O hemograma demonstra leucopenia, que pode estar relacionada a desnutrição ou outros fatores subjacentes.### Dados coletados\n\n- **Identificação e medidas**: \n  - Idade: 71 anos\n  - Sexo: Masculino\n  - Peso: 54 kg (perda de 10 kg em seis meses)\n  - Altura: 152 cm\n  - IMC: 23,3 kg/m² (calculado como peso/altura²)\n\n- **Sintomas principais**:\n  - Constipação\n  - Mal-estar ao se alimentar\n  - Distensão abdominal\n  - Disfagia progressiva\n  - Vômitos persistentes (alimentos sólidos, pastosos e líquidos)\n  - Fraqueza em membros inferiores\n  - Evacuação com fezes endurecidas\n\n- **Histórico relevante**:\n  - Doença de Chagas em acompanhamento irregular há 4 anos\n  - Passado de etilismo por 32 anos, abstêmio há 10 meses\n  - Nega tabagismo e uso de outras drogas\n  - Sem uso de medicações\n\n- **Exames disponíveis**:\n  - Hemograma: Leucócitos 3.070/mm³ (leucopenia), Hemoglobina 14 g/dL, Plaquetas 286.000/mL\n  - Bioquímica: Glicemia 92 mg/dL, Ureia 66 mg/dL (elevação), Creatinina 0,9 mg/dL, Potássio 3,9 mmol/L, Sódio 139 mEq/L, Fósforo 0,7 mmol/L (baixa)\n\n### Avaliação diagnóstica (sumária)\n\n- **Condição(ões) mais prováveis**: Acalasia do esôfago (CID-10: K22.1)\n- **Principais diferenciais**: \n  - Obstrução esofágica\n  - Câncer esofágico\n  - Esofagite\n  - Distúrbios motilidade esofágica não relacionados à Doença de Chagas\n\n- **Critérios oficiais atendidos**: Os sintomas e a associação com a Doença de Chagas atendem aos critérios para diagnóstico de acalasia, conforme diretrizes da ADA e do Ministério da Saúde.\n\n- **Achados críticos/inesperados**: Leucopenia, que pode indicar desnutrição ou outra condição subjacente.\n\n- **Justificativa sumária**: O paciente apresenta um quadro clínico clássico de acalasia, com disfagia progressiva e regurgitação, em um contexto de Doença de Chagas, que é uma causa conhecida dessa condição. A perda de peso significativa e a leucopenia são preocupantes e podem indicar desnutrição ou outra patologia associada.\n\n### Plano de investigação adicional\n\n- **Endoscopia digestiva alta**: Para avaliar diretamente o esôfago e descartar obstruções ou neoplasias.\n- **Manometria esofágica**: Para confirmar a motilidade esofágica e a incapacidade do esfíncter esofágico inferior de relaxar.\n- **Exames de imagem (ultrassonografia abdominal)**: Para avaliar a presença de massas ou outras anomalias abdominais que possam estar contribuindo para os sintomas.\n\n### Referências (se disponíveis)\n\n- Ministério da Saúde – CID-10 Brasil, 2020\n- Diretrizes da ADA sobre distúrbios esofágicos\n- Diretrizes sobre Doença de Chagas e suas complicações\n\n### Resumo final\n\n- **Principais achados**: \n  - Disfagia progressiva, regurgitação, perda de peso significativa, leucopenia.\n- **Diagnóstico provável**: Acalasia do esôfago (CID-10: K22.1).\n- **Diferenciais**: Obstrução esofágica, câncer esofágico, esofagite.\n- **Critérios atendidos**: Sintomas compatíveis com acalasia e associação com Doença de Chagas.\n- **Próximos passos recomendados**: Realizar endoscopia digestiva alta, manometria esofágica e ultrassonografia abdominal para investigação adicional."
    )

    response = request_base(url, input)
    return_data = get_return_data(response)

    print(return_data)

    assert response.status_code == 200
    assert "endoscopia digestiva alta" in return_data
    assert "manometria esofágica" in return_data
    assert "ultrassonografia abdominal" in return_data
    assert "nutrição" in return_data


def test_correct_results_joanete():
    input["text_info"] = (
        "Informações do paciente\nNome: Maria das Dores\nIdade: 62 anos\nMotivo da consulta: Dor progressiva e deformidade visível no pé direito, com dificuldade para utilizar calçados fechados e limitação para atividades diárias.\nHistórico da moléstia atual\nA paciente relata que há cerca de cinco anos percebeu uma proeminência óssea na face medial do pé direito, próxima ao dedão, inicialmente sem dor significativa. Com o passar do tempo, a saliência aumentou de tamanho e, nos últimos doze meses, a dor tornou-se mais frequente e intensa, inclusive em repouso. O desconforto é descrito como em queimação e pressão, agravando-se com o uso de calçados fechados ou salto alto e após caminhadas prolongadas.\nRelata episódios de vermelhidão e calor local, acompanhados de edema leve, principalmente no final do dia. Nos últimos meses, passou a evitar atividades físicas e reduzir o tempo em pé, devido à piora dos sintomas. Nega trauma prévio, febre, calafrios ou feridas na região afetada.\nHistória patológica pregressa\nHipertensa há 15 anos, em uso regular de losartana. Nega diagnóstico prévio de artrite reumatoide, gota ou outras doenças inflamatórias articulares. Nunca foi submetida a cirurgias ou internações hospitalares. Nega alergias medicamentosas ou alimentares conhecidas. Não faz uso de medicamentos contínuos além do anti-hipertensivo.\nHistórico familiar\nRefere que a mãe e a avó materna apresentaram deformidade semelhante nos pés, ambas submetidas a tratamento cirúrgico na idade adulta. Nega histórico familiar de artrite reumatoide, gota ou outras doenças reumatológicas. Não há registros de síndromes genéticas ou doenças ósseas hereditárias conhecidas na família.\nHistórico social\nNega tabagismo e relata consumo eventual de bebidas alcoólicas em encontros sociais. Mantém alimentação considerada equilibrada, embora com ingestão moderada de alimentos industrializados. O padrão de sono é regular, com cerca de 7 horas por noite.\nNos últimos anos, refere redução significativa da atividade física, limitando-se a caminhadas esporádicas devido à dor no pé. Trabalhou por mais de 30 anos como secretária, utilizando com frequência sapatos de salto alto e bico fino, o que acredita ter contribuído para o agravamento da deformidade. Atualmente está aposentada.\nExame físico\nPaciente em bom estado geral, normocorada, hidratada, afebril e eupneica em repouso.\nSinais vitais: pressão arterial 128/78 mmHg, frequência cardíaca 82 bpm, frequência respiratória 16 irpm, temperatura 36,4 °C, saturação de oxigênio 98% em ar ambiente.\nPé direito: desvio lateral do hálux com proeminência óssea medial evidente, acompanhada de eritema e edema leve na articulação metatarsofalângica. Dor à palpação e durante dorsiflexão do hálux.\nPele: presença de calosidade sobre a proeminência óssea, sem ulcerações.\nMarcha: discreta alteração, com apoio lateralizado do pé direito para reduzir a pressão na área dolorosa.\nDemais sistemas: sem alterações relevantes no exame físico geral.\nExames complementares\nFoi realizada radiografia do pé direito em carga, evidenciando ângulo do hálux valgus de 38° e ângulo intermetatarsal de 15°, compatíveis com deformidade moderada. Não foram observadas erosões ósseas ou sinais radiológicos de doenças inflamatórias articulares.\nExames laboratoriais solicitados para descartar causas associadas, incluindo ácido úrico, fator reumatoide e proteína C reativa, apresentaram resultados dentro da normalidade.\n\n**Sumário**\n\n1. M20.1 - Hálux valgo (joanete)\n\n**Detalhamento**\n\n- **Código:** M20.1\n- **Categoria Principal:** Hálux valgo (joanete)\n- **Descrição Detalhada:** O hálux valgo é uma deformidade caracterizada pelo desvio lateral do dedão do pé (hálux) e uma proeminência óssea na articulação metatarsofalângica. Pode causar dor, inflamação e dificuldade para calçar sapatos. A condição é frequentemente associada ao uso de calçados inadequados e pode ter um componente hereditário.\n- **Justificativa:** A paciente apresenta uma proeminência óssea e desvio lateral do hálux, acompanhados de dor e edema, além de histórico familiar de deformidade semelhante. A radiografia confirma o diagnóstico com ângulos compatíveis com deformidade moderada.\n\n**Referências**\n\n- Ministério da Saúde – CID-10 Brasil, 2020\n\n**Resumo Final**\n\nA análise dos dados clínicos e radiológicos de Maria das Dores sugere que o diagnóstico principal é hálux valgo (M20.1). A condição é evidenciada pela presença de dor e deformidade no pé direito, com proeminência óssea e desvio do hálux. A história familiar e o uso frequente de sapatos de salto alto e bico fino são fatores contribuintes. A radiografia confirma a gravidade moderada da deformidade, e os exames laboratoriais descartam outras condições inflamatórias. O manejo pode incluir modificações no uso de calçados e, eventualmente, intervenção cirúrgica se necessário.\n\n### Dados coletados\n- **Identificação e medidas**: \n  - Idade: 62 anos\n  - Sexo: Feminino\n  - Peso: Não informado\n  - Altura: Não informado\n  - IMC: Não informado\n- **Sintomas principais**:\n  - Dor progressiva e deformidade visível no pé direito\n  - Dificuldade para utilizar calçados fechados\n  - Limitação para atividades diárias\n  - Proeminência óssea na face medial do pé direito\n  - Dor em queimação e pressão, agravada pelo uso de calçados\n  - Episódios de vermelhidão, calor local e edema leve\n- **Histórico relevante**:\n  - Hipertensa em uso de losartana\n  - Nega histórico de artrite reumatoide, gota ou outras doenças inflamatórias\n  - Sem cirurgias ou internações anteriores\n  - Sem alergias conhecidas\n- **Exames disponíveis**:\n  - Radiografia do pé direito: ângulo do hálux valgus de 38° e ângulo intermetatarsal de 15° (deformidade moderada)\n  - Exames laboratoriais: ácido úrico, fator reumatoide e proteína C reativa dentro da normalidade\n\n### Avaliação diagnóstica (sumária)\n- **Condição(ões) mais prováveis**: Hálux valgo (M20.1) é a condição mais provável, caracterizada pelo desvio lateral do hálux e proeminência óssea, acompanhada de dor e edema.\n- **Principais diferenciais**: Metatarsalgia, artrite degenerativa, bursite.\n- **Critérios oficiais atendidos**: Diagnóstico compatível com a CID-10 M20.1, com confirmação radiológica.\n- **Achados críticos/inesperados**: A presença de dor em repouso e a deformidade progressiva são relevantes, indicando a necessidade de manejo adequado.\n- **Justificativa sumária**: A paciente apresenta sinais clássicos de hálux valgo, com dor e deformidade evidentes, além de um histórico familiar que sugere um componente hereditário. A radiografia confirma a gravidade da deformidade, e os exames laboratoriais descartam outras condições inflamatórias.\n\n### Plano de investigação adicional\n- **Exames sugeridos**:\n  - **Ultrassonografia do pé**: Para avaliar a presença de bursite ou outras alterações nos tecidos moles.\n  - **Avaliação podológica**: Para análise da marcha e adaptação de calçados.\n  - **Teste de função articular**: Para descartar outras condições articulares que possam estar contribuindo para os sintomas.\n\n### Referências (se disponíveis)\n- Ministério da Saúde – CID-10 Brasil, 2020\n- Diretrizes da Sociedade Brasileira de Ortopedia e Traumatologia sobre deformidades do pé\n- Diretrizes da American Academy of Orthopaedic Surgeons sobre hálux valgo\n\n### Resumo final\n- **Principais achados**:\n  - Deformidade do pé direito com dor e proeminência óssea\n  - Histórico familiar de condições semelhantes\n  - Radiografia confirma hálux valgo moderado\n- **Diagnóstico provável**: Hálux valgo (M20.1)\n- **Diferenciais**: Metatarsalgia, artrite degenerativa, bursite\n- **Critérios atendidos**: CID-10 M20.1 com confirmação radiológica\n- **Próximos passos recomendados**: Modificações no uso de calçados, avaliação podológica e considerar intervenção cirúrgica se os sintomas persistirem ou se agravarem."
    )

    response = request_base(url, input)
    return_data = get_return_data(response)
    print(return_data)

    assert response.status_code == 200
    assert "adaptação" or "ajuste" in return_data
    assert "avaliação podológica" in return_data
    assert "ultrassonografia do pé" in return_data


def test_error_invalid_input():
    input["text_info"] = 500

    response = request_base(url, input)
    return_data = response.json()["detail"][0]

    assert response.status_code == 422
    assert "Input should be a valid string" in return_data["msg"]
